# ==============================================================================
# .tmux.conf, Tmux version 3.6a
# ==============================================================================

# ------------------------------------------------------------------------------
# 初期化
# ------------------------------------------------------------------------------
# キーストロークのディレイを減らす (default: 500ms)
set-option -g escape-time 50

# 端末を 256色に設定 (default: tmux-256color)
set-option -g default-terminal "xterm-256color"
# OSC 52 でクリップボード共有するため Ms を設定
set-option -ga terminal-overrides ",xterm*:colors=256:Ms=\\E]52;c;%p2%s\\007"

# スクロール行数 (default: 2000)
set-option -g history-limit 200000

# Use vi keys in copy mode
set-window-option -g mode-keys vi


# ------------------------------------------------------------------------------
# MSYS2
# ------------------------------------------------------------------------------
# MSYS2 専用、タスクバータイトルを tmux に固定する
if-shell "test -n \"$MSYSTEM\"" {
	set-option -g set-titles on
	set-option -g set-titles-string "tmux"
}


# ------------------------------------------------------------------------------
# Mouse
# ------------------------------------------------------------------------------
# マウスモードを有効化 (ペイン選択, リサイズ, スクロール)
set-option -g mouse on

# 右クリック内容を日本語化
bind-key -T root MouseDown3Pane \
	if-shell -F -t = "#{||:#{mouse_any_flag},#{&&:#{pane_in_mode},#{?#{m/r:(copy|view)-mode,#{pane_mode}},0,1}}}" \
	{ select-pane -t = ; send-keys -M } \
	{ display-menu -T "#[align=centre]#{pane_index} (#{pane_id})" -t = -x M -y M \
		"#{?#{m/r:(copy|view)-mode,#{pane_mode}},一番上に移動する,}"      "<" { send-keys -X history-top } \
		"#{?#{m/r:(copy|view)-mode,#{pane_mode}},一番下に移動する,}"   ">" { send-keys -X history-bottom } \
		"" \
		"#{?mouse_word,#[underscore]#{=/9/...:mouse_word} を検索する,}" "C-r" { if-shell -F "#{?#{m/r:(copy|view)-mode,#{pane_mode}},0,1}" "copy-mode -t=" ; send-keys -X -t = search-backward -- "#{q:mouse_word}" } \
		"#{?mouse_word,#[underscore]#{=/9/...:mouse_word} と入力する,}"       "C-y" { copy-mode -q ; send-keys -l "#{q:mouse_word}" } \
		"#{?mouse_word,#[underscore]#{=/9/...:mouse_word} をコピーする,}"       "c"   { copy-mode -q ; set-buffer "#{q:mouse_word}" } \
		"#{?mouse_line,行をコピーする,}"                                     "l"   { copy-mode -q ; set-buffer "#{q:mouse_line}" } \
		"" \
		"#{?mouse_hyperlink,#[underscore]#{=/9/...:mouse_hyperlink} と入力する,}" "C-h" { copy-mode -q ; send-keys -l "#{q:mouse_hyperlink}" } \
		"#{?mouse_hyperlink,#[underscore]#{=/9/...:mouse_hyperlink} リンクをコピーする,}" "h"   { copy-mode -q ; set-buffer "#{q:mouse_hyperlink}" } \
		"" \
		"ペインを横に増やす" "h" { split-window -h } \
		"ペインを縦に増やす"   "v" { split-window -v } \
		"" \
		"#{?#{>:#{window_panes},1},,-}ペインを上と交換する"     "u" { swap-pane -U } \
		"#{?#{>:#{window_panes},1},,-}ペインを下と交換する"   "d" { swap-pane -D } \
		"#{?pane_marked_set,,-}マーク付きペインと入れ替える"        "s" { swap-pane } \
		"" \
		"ペインを閉じる"                        "X" { kill-pane } \
		"ペインを初期化する"                     "R" { respawn-pane -k } \
		"#{?pane_marked,マーク解除,ペインをマーク}" "m" { select-pane -m } \
		"#{?#{>:#{window_panes},1},,-}#{?window_zoomed_flag,ズーム解除,ペインをズーム}" "z" { resize-pane -Z } \
	}

# スクロールアップするとコピーモードに入る
bind-key -n WheelUpPane \
	if-shell -F -t = "#{mouse_any_flag}" \
		"send-keys -M" \
		"if-shell -Ft= '#{pane_in_mode}' \
			'send-keys -M' \
			'select-pane -t=; copy-mode -e; send-keys -M'"

# 最後までスクロールダウンするとコピーモードを抜ける
bind-key -n WheelDownPane select-pane -t= \; send-keys -M

# マウスをドラッグして選択範囲を定め、それをヤンクしてコピーモードを終了する
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel


# ------------------------------------------------------------------------------
# Theme - Solarized Dark Higher Contrast
# Ref: https://github.com/Gogh-Co/Gogh/blob/master/installs/solarized-dark-higher-contrast.sh
# ------------------------------------------------------------------------------
# 16色カラーパレット (明るい色が実際の色になっている)
#   black        : #002831
#   red          : #D11C24
#   green        : #6CBE6C
#   yellow       : #A57706
#   blue         : #2176C7
#   magenta      : #C61C6F
#   cyan         : #259286
#   white        : #EAE3CB
#   brightblack  : #006488
#   brightred    : #F5163B
#   brightgreen  : #51EF84
#   brightyellow : #B27E28
#   brightblue   : #178EC8
#   brightmagenta: #E24D8E
#   brightcyan   : #00B39E
#   brightwhite  : #FCF4DC

# -- Status line ---------------------------------------------------------------
# ステータスメッセージ
set-option -g message-style "fg=brightred,bg=black"

# status line を更新する間隔を 1 秒にする (default: 15)
set-option -g status-interval 1

# ステータスバー
set-option -g status-style "fg=brightblue,bg=black"

# status-left
set-option -g status-left-length 20
set-option -g status-left "#[fg=black,bg=green] #S #[default] "

# status-right
set-option -g status-right-length 60
set-option -g status-right "#[fg=brightcyan] #h | %m/%d %H:%M:%S "

# -- Window --------------------------------------------------------------------
# インアクティブ window
set-window-option -g window-status-format " #I:#W#F "
set-window-option -g window-status-style "fg=brightblue,bg=default"

# アクティブ window
set-window-option -g window-status-current-format " #I:#W#F "
set-window-option -g window-status-current-style "fg=brightred,bg=black"

# activity
set-window-option -g window-status-activity-style "fg=yellow,bg=default"

# bell
set-window-option -g window-status-bell-style "fg=black,bg=red"

# clock
set-window-option -g clock-mode-colour cyan

# -- Pane ----------------------------------------------------------------------
# ペイン境界線
set-window-option -g pane-border-style "fg=brightblack,bg=default"
set-window-option -g pane-active-border-style "fg=green,bg=default"

# ペイン境界線ステータス
set-window-option -g pane-border-status bottom
set-window-option -g pane-border-format "#[fg=black,bg=blue] #P #[fg=brightcyan,bg=default] #{pane_current_command} "


# ------------------------------------------------------------------------------
# Window
# ------------------------------------------------------------------------------
# ウィンドウのインデックスを1から始める
set-option -g base-index 1

# window タイトルを自動変更する
set-window-option -g automatic-rename on


# ------------------------------------------------------------------------------
# Pane
# ------------------------------------------------------------------------------
# ペインのインデックスを1から始める
set-window-option -g pane-base-index 1


# ------------------------------------------------------------------------------
# Keybinding
# ------------------------------------------------------------------------------
# 設定ファイルをリロード
bind-key "r" source-file "~/.tmux.conf" \; display "Reloaded!"

# Alt + 矢印でペインをリサイズする
bind-key -n M-Up    resize-pane -U 5
bind-key -n M-Down  resize-pane -D 5
bind-key -n M-Left  resize-pane -L 5
bind-key -n M-Right resize-pane -R 5

# ディレクトリパスを引き継ぐ
# 新しい Window
bind-key "c" new-window -c "#{pane_current_path}"
# 現在のPaneを水平分割してWindowを開く
bind-key "%" split-window -h -c "#{pane_current_path}"
# 現在のPaneを垂直分割してWindowを開く
bind-key "\"" split-window -v -c "#{pane_current_path}"


# ------------------------------------------------------------------------------
# Copy & Paste
# ------------------------------------------------------------------------------
# Ref: https://github.com/tmux/tmux/wiki/Clipboard
#
# Copy: OSC 52 を利用
# Paste: Ctrl+Shift+V を利用

# OSC 52 を有効化 (Vim 等からの OSC 52 もパススルー)
set-option -s set-clipboard external

# コピーモード中に Vim 風に v で選択範囲を定める
bind-key -T copy-mode-vi v send-keys -X begin-selection
# コピーモード中に Vim 風に y で選択範囲をヤンクしてコピーモードを終了する
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel

# tmux バッファからペースト (bracket paste mode対応)
bind-key "]" paste-buffer -p
